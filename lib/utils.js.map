{"version":3,"sources":["../src/utils.js"],"names":["childProcess","require","fs","waitStream","Promise","stream","on","resolve","cachePackageJson","utils","execSync","cmd","stdout","toString","isError","e","stderr","exec","reject","child","chunk","err","code","signal","readNpmVersion","name","result","ind","indexOf","substr","length","split","checkExistsNpm","JSON","parse","readFileSync","dependencies","devDependencies","module","exports"],"mappings":"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","file":"utils.js","sourcesContent":["'use strict'\n// @flow\n\nconst childProcess = require('child_process')\nconst fs = require('fs')\n\nconst waitStream = stream => new Promise(resolve => {\n    stream.on('end', () => resolve())\n})\n\nlet cachePackageJson = null\n\nconst utils = {\n    execSync: (cmd: string) => {\n        try {\n            const stdout = childProcess.execSync(cmd).toString('utf-8')\n            return {isError: false, stdout}\n        } catch (e) {\n            const stdout = e.stdout.toString('utf-8')\n            const stderr = e.stderr.toString('utf-8')\n            return {isError: true, stdout, stderr}\n        }\n    },\n    exec: (cmd: string) => new Promise((resolve, reject) => {\n        const child = childProcess.exec(cmd)\n\n        let stdout = ''\n        let stderr = ''\n\n        child.stdout.on('data', chunk => {\n            stdout += chunk.toString()\n        })\n\n        child.stderr.on('data', chunk => {\n            stderr += chunk.toString()\n        })\n\n        child.on('error', err => {\n            reject(err)\n        })\n        child.on('exit', async (code, signal) => {\n            // await waitStream(child.stdout)\n            // await waitStream(child.stderr)\n            resolve({code, stdout, stderr})\n        })\n    }),\n    readNpmVersion: (name: string) => {\n        const result = childProcess.execSync('npm list --depth=0').toString()\n        const ind = result.indexOf(`${name}@`)\n        if (ind !== -1) {\n            return result.substr(ind + name.length + 1).split('\\n')[0]\n        } else {\n            return null\n        }\n    },\n    checkExistsNpm: (name: string) => {\n        if (!cachePackageJson) {\n            try {\n                cachePackageJson = JSON.parse(fs.readFileSync('package.json').toString())\n            } catch (e) {\n                return false\n            }\n        }\n\n        if (cachePackageJson.dependencies && cachePackageJson.dependencies[name]) {\n            return true\n        }\n\n        if (cachePackageJson.devDependencies && cachePackageJson.devDependencies[name]) {\n            return true\n        }\n        return false\n    }\n}\n\nmodule.exports = utils\n"]}