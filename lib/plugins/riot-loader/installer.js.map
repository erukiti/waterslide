{"version":3,"sources":["../../../src/plugins/riot-loader/installer.js"],"names":["path","require","fs","RiotLoaderInstaller","operator","generator","generate","name","opts","render","inFile","outFile","opts2","fn","join","__dirname","content","readFileSync","toString","writeFile","dir","dirname","type","getGenerator","replaceGenerator","getInstaller","jsInstaller","addPackage","addDevPackage","webpackInstaller","addLoader","loader","options","sourceMap","module","exports"],"mappings":"AAAA;;;;;;;;AAEA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,KAAKD,QAAQ,IAAR,CAAX;;IAEME,mB;AACF,iCAAYC,QAAZ,EAAsB;AAAA;;AAAA;;AAClB,aAAKA,QAAL,GAAgBA,QAAhB;;AAEA,YAAMC,YAAY;AACdC;AAAA,qEAAU,kBAAOC,IAAP;AAAA,wBAAaC,IAAb,uEAAoB,EAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AACAC,0CADA;AAAA,8FACS,iBAAOC,MAAP,EAAeC,OAAf;AAAA,gDAAwBC,KAAxB,uEAAgC,EAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AACLC,8DADK,GACAb,KAAKc,IAAL,CAAUC,SAAV,EAAqBL,MAArB,CADA;AAELM,mEAFK,GAEKd,GAAGe,YAAH,CAAgBJ,EAAhB,EAAoBK,QAApB,EAFL;AAAA;AAAA,mEAGL,MAAKd,QAAL,CAAce,SAAd,CAAwBR,OAAxB,EAAiCK,OAAjC,EAA0CJ,KAA1C,CAHK;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCADT;;AAAA,wDACAH,MADA;AAAA;AAAA;AAAA;;AAOAW,uCAPA,GAOMpB,KAAKqB,OAAL,CAAad,IAAb,CAPN;AAAA;AAAA,2CAQAE,OAAO,aAAP,EAAyBW,GAAzB,kBAA2C,EAACE,MAAM,MAAP,EAA3C,CARA;;AAAA;AAAA;AAAA,2CASAb,OAAO,WAAP,EAAuBW,GAAvB,gBAAuCZ,IAAvC,CATA;;AAAA;AAAA;AAAA,2CAWA,MAAKJ,QAAL,CAAcmB,YAAd,CAA2B,aAA3B,EAA0CjB,QAA1C,CAAsDc,GAAtD,cAXA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAV;;AAAA;AAAA;AAAA;;AAAA;AAAA;AADc,SAAlB;;AAgBA,aAAKhB,QAAL,CAAcoB,gBAAd,CAA+B,SAA/B,EAA0CnB,SAA1C;AACH;;;;;;;;;;;;uCAO6B,KAAKD,QAAL,CAAcqB,YAAd,CAA2B,IAA3B,C;;;AAApBC,2C;;AACNA,4CAAYC,UAAZ,CAAuB,MAAvB;AACAD,4CAAYE,aAAZ,CAA0B,YAA1B;;;uCAE+B,KAAKxB,QAAL,CAAcqB,YAAd,CAA2B,SAA3B,C;;;AAAzBI,gD;;AACNA,iDAAiBC,SAAjB,CAA2B,QAA3B,EAAqC,CACjC,EAACC,QAAQ,cAAT,EAAyBC,SAAS,EAACC,WAAW,IAAZ,EAAlC,EADiC,EAEjC,EAACF,QAAQ,YAAT,EAFiC,CAArC;;;;;;;;;;;;;;;;;;qCAVgB3B,Q,EAAU;AAC1B,mBAAO,IAAI,IAAJ,CAASA,QAAT,CAAP;AACH;;;;;;AAgBL8B,OAAOC,OAAP,GAAiBhC,mBAAjB","file":"installer.js","sourcesContent":["'use strict'\n\nconst path = require('path')\nconst fs = require('fs')\n\nclass RiotLoaderInstaller {\n    constructor(operator) {\n        this.operator = operator\n\n        const generator = {\n            generate: async (name, opts = {}) => {\n                const render = async (inFile, outFile, opts2 = {}) => {\n                    const fn = path.join(__dirname, inFile)\n                    const content = fs.readFileSync(fn).toString()\n                    await this.operator.writeFile(outFile, content, opts2)\n                }\n\n                const dir = path.dirname(name)\n                await render('sample.html', `${dir}/index.html`, {type: 'copy'})\n                await render('sample.js', `${dir}/index.js`, opts)\n\n                await this.operator.getGenerator('riot-loader').generate(`${dir}/app.tag`)\n            }\n        }\n\n        this.operator.replaceGenerator('browser', generator)\n    }\n\n    static getInstaller(operator) {\n        return new this(operator)\n    }\n\n    async install() {\n        const jsInstaller = await this.operator.getInstaller('js')\n        jsInstaller.addPackage('riot')\n        jsInstaller.addDevPackage('tag-loader')\n\n        const webpackInstaller = await this.operator.getInstaller('webpack')\n        webpackInstaller.addLoader('\\\\.tag', [\n            {loader: 'babel-loader', options: {sourceMap: true}},\n            {loader: 'tag-loader'}\n        ])\n\n    }\n}\n\nmodule.exports = RiotLoaderInstaller\n"]}