{"version":3,"sources":["../../../src/plugins/riot-loader/installer.js"],"names":["path","require","fs","RiotLoaderInstaller","constructor","operator","generator","generate","name","opts","render","inFile","outFile","opts2","fn","join","__dirname","content","readFileSync","toString","writeFile","dir","dirname","type","getGenerator","replaceGenerator","getInstaller","install","jsInstaller","addPackage","addDevPackage","webpackInstaller","addLoader","loader","options","sourceMap","module","exports"],"mappings":"AAAA;;;;AAEA,MAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,MAAMC,KAAKD,QAAQ,IAAR,CAAX;;AAEA,MAAME,mBAAN,CAA0B;AACtBC,gBAAYC,QAAZ,EAAsB;AAAA;;AAClB,aAAKA,QAAL,GAAgBA,QAAhB;;AAEA,cAAMC,YAAY;AACdC;AAAA,6CAAU,WAAOC,IAAP,EAAaC,OAAO,EAApB,EAA2B;AACjC,0BAAMC;AAAA,sDAAS,WAAOC,MAAP,EAAeC,OAAf,EAAwBC,QAAQ,EAAhC,EAAuC;AAClD,kCAAMC,KAAKd,KAAKe,IAAL,CAAUC,SAAV,EAAqBL,MAArB,CAAX;AACA,kCAAMM,UAAUf,GAAGgB,YAAH,CAAgBJ,EAAhB,EAAoBK,QAApB,EAAhB;AACA,kCAAM,MAAKd,QAAL,CAAce,SAAd,CAAwBR,OAAxB,EAAiCK,OAAjC,EAA0CJ,KAA1C,CAAN;AACH,yBAJK;;AAAA;AAAA;AAAA;AAAA,wBAAN;;AAMA,0BAAMQ,MAAMrB,KAAKsB,OAAL,CAAad,IAAb,CAAZ;AACA,0BAAME,OAAO,iBAAP,EAA2B,GAAEW,GAAI,aAAjC,EAA+C,EAACE,MAAM,MAAP,EAA/C,CAAN;AACA,0BAAMb,OAAO,eAAP,EAAyB,GAAEW,GAAI,WAA/B,EAA2CZ,IAA3C,CAAN;;AAEA,0BAAM,MAAKJ,QAAL,CAAcmB,YAAd,CAA2B,aAA3B,EAA0CjB,QAA1C,CAAoD,GAAEc,GAAI,UAA1D,CAAN;AACH,iBAZD;;AAAA;AAAA;AAAA;AAAA;AADc,SAAlB;;AAgBA,aAAKhB,QAAL,CAAcoB,gBAAd,CAA+B,SAA/B,EAA0CnB,SAA1C;AACH;;AAED,WAAOoB,YAAP,CAAoBrB,QAApB,EAA8B;AAC1B,eAAO,IAAI,IAAJ,CAASA,QAAT,CAAP;AACH;;AAEKsB,WAAN,GAAgB;AAAA;;AAAA;AACZ,kBAAMC,cAAc,MAAM,OAAKvB,QAAL,CAAcqB,YAAd,CAA2B,IAA3B,CAA1B;AACAE,wBAAYC,UAAZ,CAAuB,MAAvB;AACAD,wBAAYE,aAAZ,CAA0B,YAA1B;AACA;;AAEA,kBAAMC,mBAAmB,MAAM,OAAK1B,QAAL,CAAcqB,YAAd,CAA2B,SAA3B,CAA/B;AACAK,6BAAiBC,SAAjB,CAA2B,QAA3B,EAAqC,CACjC,EAACC,QAAQ,cAAT,EAAyBC,SAAS,EAACC,WAAW,IAAZ,EAAlC,EADiC,EAEjC,EAACF,QAAQ,YAAT,EAFiC,CAArC;AAPY;AAYf;AAvCqB;;AA0C1BG,OAAOC,OAAP,GAAiBlC,mBAAjB","file":"installer.js","sourcesContent":["'use strict'\n\nconst path = require('path')\nconst fs = require('fs')\n\nclass RiotLoaderInstaller {\n    constructor(operator) {\n        this.operator = operator\n\n        const generator = {\n            generate: async (name, opts = {}) => {\n                const render = async (inFile, outFile, opts2 = {}) => {\n                    const fn = path.join(__dirname, inFile)\n                    const content = fs.readFileSync(fn).toString()\n                    await this.operator.writeFile(outFile, content, opts2)\n                }\n\n                const dir = path.dirname(name)\n                await render('riot-index.html', `${dir}/index.html`, {type: 'copy'})\n                await render('riot-index.js', `${dir}/index.js`, opts)\n\n                await this.operator.getGenerator('riot-loader').generate(`${dir}/app.tag`)\n            }\n        }\n\n        this.operator.replaceGenerator('browser', generator)\n    }\n\n    static getInstaller(operator) {\n        return new this(operator)\n    }\n\n    async install() {\n        const jsInstaller = await this.operator.getInstaller('js')\n        jsInstaller.addPackage('riot')\n        jsInstaller.addDevPackage('tag-loader')\n        // jsInstaller.addDevPackage('riotjs-loader', 1)\n\n        const webpackInstaller = await this.operator.getInstaller('webpack')\n        webpackInstaller.addLoader('\\\\.tag', [\n            {loader: 'babel-loader', options: {sourceMap: true}},\n            {loader: 'tag-loader'}\n        ])\n\n    }\n}\n\nmodule.exports = RiotLoaderInstaller\n"]}