{"version":3,"sources":["../../../src/plugins/webpack/installer.js"],"names":["utils","getConfig","require","config","WebpackInstaller","constructor","operator","values","getLocal","rules","getInstaller","addLoader","test","use","found","findIndex","value","forEach","loader","options","find","push","exclude","writeLocal","install","addBuilder","jsInstaller","addDevPackage","module","exports"],"mappings":"AAAA;;;;AAEA,MAAM,EAACA,KAAD,EAAQC,SAAR,KAAqBC,QAAQ,kBAAR,CAA3B;AACA,MAAMC,SAASF,WAAf;;AAEA,MAAMG,gBAAN,CAAuB;AACnBC,gBAAYC,QAAZ,EAAsB;AAClB,aAAKA,QAAL,GAAgBA,QAAhB;AACA,aAAKC,MAAL,GAAcJ,OAAOK,QAAP,CAAgB,SAAhB,KAA8B,EAACC,OAAO,EAAR,EAA5C;AACH;;AAED,WAAOC,YAAP,CAAoBJ,QAApB,EAA8B;AAC1B,eAAO,IAAI,IAAJ,CAASA,QAAT,CAAP;AACH;;AAEDK,cAAUC,IAAV,EAAgBC,GAAhB,EAAqB;AACjB,cAAMC,QAAQ,KAAKP,MAAL,CAAYE,KAAZ,CAAkBM,SAAlB,CAA4BC,SAASA,MAAMJ,IAAN,KAAeA,IAApD,CAAd;AACA,YAAIE,UAAU,CAAC,CAAf,EAAkB;AACdD,gBAAII,OAAJ,CAAY,CAAC,EAACC,MAAD,EAASC,OAAT,EAAD,KAAuB;AAC/B,oBAAI,CAAC,KAAKZ,MAAL,CAAYE,KAAZ,CAAkBK,KAAlB,EAAyBD,GAAzB,CAA6BO,IAA7B,CAAkCJ,SAASA,MAAME,MAAN,KAAiBA,MAA5D,CAAL,EAA0E;AACtE,yBAAKX,MAAL,CAAYE,KAAZ,CAAkBK,KAAlB,EAAyBD,GAAzB,CAA6BQ,IAA7B,CAAkC,EAACH,MAAD,EAASC,OAAT,EAAkBG,SAAS,cAA3B,EAAlC;AACH;AACJ,aAJD;;AAMA;AACH;AACD,aAAKf,MAAL,CAAYE,KAAZ,CAAkBY,IAAlB,CAAuB,EAACT,IAAD,EAAOC,GAAP,EAAvB;AACAZ,oBAAYsB,UAAZ,CAAuB,SAAvB,EAAkC,KAAKhB,MAAvC;AACH;;AAEKiB,WAAN,GAAgB;AAAA;;AAAA;AACZ,kBAAKlB,QAAL,CAAcmB,UAAd,CAAyB,SAAzB;AACA,kBAAMC,cAAc,MAAM,MAAKpB,QAAL,CAAcI,YAAd,CAA2B,IAA3B,CAA1B;AACAgB,wBAAYC,aAAZ,CAA0B,SAA1B;AACAD,wBAAYC,aAAZ,CAA0B,cAA1B;AAJY;AAKf;AA9BkB;;AAiCvBC,OAAOC,OAAP,GAAiBzB,gBAAjB","file":"installer.js","sourcesContent":["'use strict'\n\nconst {utils, getConfig} = require('../../waterslide')\nconst config = getConfig()\n\nclass WebpackInstaller {\n    constructor(operator) {\n        this.operator = operator\n        this.values = config.getLocal('webpack') || {rules: []}\n    }\n\n    static getInstaller(operator) {\n        return new this(operator)\n    }\n\n    addLoader(test, use) {\n        const found = this.values.rules.findIndex(value => value.test === test)\n        if (found !== -1) {\n            use.forEach(({loader, options}) => {\n                if (!this.values.rules[found].use.find(value => value.loader === loader)) {\n                    this.values.rules[found].use.push({loader, options, exclude: 'node_modules'})\n                }\n            })\n\n            return\n        }\n        this.values.rules.push({test, use})\n        getConfig().writeLocal('webpack', this.values)\n    }\n\n    async install() {\n        this.operator.addBuilder('webpack')\n        const jsInstaller = await this.operator.getInstaller('js')\n        jsInstaller.addDevPackage('webpack')\n        jsInstaller.addDevPackage('babel-loader')\n    }\n}\n\nmodule.exports = WebpackInstaller\n"]}