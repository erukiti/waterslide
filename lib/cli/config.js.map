{"version":3,"sources":["../../src/cli/config.js"],"names":["config","require","Menu","createCharm","readPrompt","PassThrough","DummyInput","destroy","charm","input","prompt","item","Promise","resolve","reject","desc","err","result","writeGlobal","name","createMenu","items","menu","reset","cb","menuStream","createStream","passDataToMenu","data","write","forEach","label","add","close","workAround","process","stdin","on","pipe","stdout","end","setRawMode","resume","unpipe","removeListener","selectLicense","licenses","push","license","configurable","configMenu","getGlobal","exit","configLoop","catch","console","dir","e","configCommand","command","describe","builder","yargs","handler","argv","key","value","log","validKeys","map","includes","module","exports"],"mappings":"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","file":"config.js","sourcesContent":["'use strict'\n// @flow\n\nconst config = require('../config')\nconst Menu = require('terminal-menu')\nconst createCharm = require('charm')\nconst readPrompt = require('read')\nconst {PassThrough} = require('stream')\n\n\ntype MenuItem = {\n    label: string,\n    cb?: () => any,\n}\n\nclass DummyInput extends PassThrough {\n    destroy() {}\n}\n\nconst charm = createCharm({input: new DummyInput()})\n\nconst prompt = item => {\n    return new Promise((resolve, reject) => {\n        readPrompt({prompt: item.desc}, (err, result) => {\n            if (err) {\n                reject(err)\n            } else {\n                config.writeGlobal(item.name, result)\n                resolve()\n            }\n        })\n    })\n}\n\nconst createMenu = (items: Array<MenuItem>) => {\n    return new Promise((resolve, reject) => {\n        const menu = new Menu({charm})\n        menu.reset()\n\n        let cb = null\n\n        const menuStream = menu.createStream()\n        const passDataToMenu = data => menuStream.write(data)\n\n        items.forEach(item => {\n            if (!item.cb) {\n                menu.write(item.label)\n            } else {\n                menu.add(item.label, () => {\n                    cb = item.cb\n                    menu.close()\n                })\n            }\n        })\n\n        // see. https://github.com/facebook/flow/issues/2944\n        const workAround: any = process.stdin\n\n        process.stdin.on('data', passDataToMenu)\n        menuStream.pipe(process.stdout, {end: false})\n        workAround.setRawMode(true)\n        process.stdin.resume()\n\n        menu.on('close', () => {\n            menuStream.unpipe(process.stdout)\n            process.stdin.removeListener('data', passDataToMenu)\n            workAround.setRawMode(false)\n            resolve(cb)\n        })\n    })\n}\n\nconst selectLicense = item => {\n    const licenses = [\n        {name: 'Apache-2.0', desc: 'Apache License 2.0'},\n        {name: 'BSD-2-Clause', desc: 'BSD 2-clause \"Simplified\" License'},\n        {name: 'BSD-3-Clause', desc: 'BSD 3-clause \"New\" or \"Revised License'},\n        {name: 'AGPL-3.0', desc: 'GNU Affero General Public License v3.0'},\n        {name: 'GPL-2.0', desc: 'GNU General Public License v2.0 only'},\n        {name: 'GPL-3.0', desc: 'GNU General Public License v3.0 only'},\n        {name: 'LGPL-2.0', desc: 'GNU Library General Public License v2 only'},\n        {name: 'LGPL-2.1', desc: 'GNU Lesser General Public License v2.1 only'},\n        {name: 'LGPL-3.0', desc: 'GNU Lesser General Public License v3.0 only'},\n        {name: 'MIT', desc: 'MIT License'},\n    ]\n\n    const items: Array<MenuItem> = []\n    items.push({label: 'Please select default your license\\n\\n'})\n    licenses.forEach(license => {\n        items.push({label: license.desc, cb: () => {\n            config.writeGlobal('license', license.name)\n        }})\n    })\n\n    items.push({label: '\\n'})\n    items.push({label: 'Input other license', cb: () => {\n        return prompt({name: 'license', desc: 'input license name (see. https://spdx.org/licenses/)'})\n    }})\n\n    items.push({label: '\\n'})\n    items.push({label: 'quit', cb: () => {}})\n    return createMenu(items)\n}\n\nconst configurable = [\n    {name: 'name', desc: 'your name (use author\\'s credit)', cb: prompt},\n    {name: 'email', desc: 'your email (use author\\'s credit)', cb: prompt},\n    {name: 'homepage', desc: 'your homepage url (use author\\'s credit)', cb: prompt},\n    {name: 'license', desc: 'default license', cb: selectLicense},\n]\n\nconst configMenu = () => {\n    const items: Array<MenuItem> = []\n    items.push({label: 'waterslide global configuration\\n\\n'})\n\n    configurable.forEach(item => {\n        items.push({label: `${item.name}: ${config.getGlobal(item.name)}`, cb: () => item.cb(item)})\n    })\n\n    items.push({label: '\\n'})\n    items.push({label: 'exit', cb: () => process.exit(0)})\n\n    return createMenu(items)\n}\n\nconst configLoop = async () => {\n    let cb = await configMenu().catch(e => console.dir(e))\n    for (;;) {\n        if (!cb) {\n            cb = await configMenu().catch(e => console.dir(e))\n        }\n        cb = await cb()\n    }\n}\n\n\nconst configCommand = () => {\n    return {\n        command: 'config [key] [value]',\n        describe: 'global configuration',\n        builder: (yargs: Object) => {\n\n        },\n        handler: (argv: Object) => {\n            if (!argv.key && !argv.value) {\n                configLoop()\n                return\n            }\n\n            if (!argv.value) {\n                console.log(`${argv.key}: ${config.getGlobal(argv.key)}`)\n                return\n            }\n\n            const validKeys = configurable.map(item => item.name)\n\n            if (validKeys.includes(argv.key)) {\n                config.writeGlobal(argv.key, argv.value)\n            } else {\n                console.log('invalid key')\n            }\n        }\n    }\n}\n\nmodule.exports = configCommand\n"]}