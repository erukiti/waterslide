{"version":3,"sources":["../../src/setup/index.js"],"names":["process","require","fs","getConfig","Plugin","config","plugin","Fsio","Command","Operator","CliUtils","Setup","constructor","cliUtils","fsio","command","projectDir","installers","generators","noOpt","noUse","postInstalls","directories","getLocal","entries","finalizer","builders","testers","opt","info","operator","addBuilder","setProjectDir","name","setOpt","length","error","writeLocal","setNoOpt","setNoUse","install","processed","getNotProcessedKey","Object","keys","filter","includes","key","notProcessed","concat","Promise","all","map","cb","execAll","verbose","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\n// @flow\n\nconst process = require('process')\nconst fs = require('fs')\n\nconst {getConfig, Plugin} = require('../waterslide')\nconst config = getConfig()\nconst plugin = new Plugin()\nconst Fsio = require('./fsio')\nconst Command = require('./command')\nconst Operator = require('./operator')\nconst CliUtils = require('../cli/utils')\n\nimport type {Entry} from '../config'\n\nexport interface Generator {\n    generate(name: string, opts?: Object): void\n}\n\n// FIXME\nexport type Installer = any\n\n// export interface Installer {\n//     install: () => {},\n//     setDirectory?: (path: string, description?: string) => void\n// }\n\ntype Info = {\n    title: string,\n    message: string\n}\n\n\nclass Setup {\n    fsio: Fsio\n    command: Command\n    cliUtils: CliUtils\n    projectDir: ?string\n    installers: {[string]: Installer}\n    noOpt: Array<string>\n    noUse: Array<string>\n    opt: Array<string>\n    postInstalls: Array<() => void>\n    directories: {[string]: string}\n    generators: {[string]: Generator}\n    entries: Array<Entry>\n    operator: Operator\n    finalizer: ?string\n    builders: Array<string>\n    testers: Array<string>\n    info: Array<Info>\n\n    constructor(cliUtils: CliUtils) {\n        this.fsio = new Fsio()\n        this.cliUtils = cliUtils\n        this.command = new Command(require('child_process'))\n        this.projectDir = null // FIXME\n        this.installers = {}\n        this.generators = {}\n        this.noOpt = []\n        this.noUse = []\n\n        this.postInstalls = []\n\n        this.directories = config.getLocal('directories') || {}\n        this.entries = config.getLocal('entries') || []\n        this.finalizer = config.getLocal('finalizer')\n        this.builders = config.getLocal('builders') || []\n        this.testers = config.getLocal('testers') || []\n        this.opt = config.getLocal('opt') || []\n        this.info = config.getLocal('info') || []\n\n        this.operator = new Operator(this)\n\n        this.operator.addBuilder('copy')\n    }\n\n    setProjectDir(name: string) {\n        this.projectDir = name\n    }\n\n    setOpt(opt: Array<string>) {\n        if (this.opt.length > 0) {\n            this.cliUtils.error('warning: opt is already set.')\n        }\n\n        this.opt = opt\n        config.writeLocal('opt', this.opt)\n    }\n\n    setNoOpt(noOpt: Array<string>) {\n        if (this.noOpt.length > 0) {\n            this.cliUtils.error('warning: noOpts is already set.')\n        }\n\n        this.noOpt = noOpt\n    }\n\n    setNoUse(noUse: Array<string>) {\n        if (this.noUse.length > 0) {\n            this.cliUtils.error('warning: noUse is already set.')\n        }\n\n        this.noUse = noUse\n    }\n\n    async install() {\n        let processed = []\n\n        const getNotProcessedKey = () => Object.keys(this.installers).filter(key => !processed.includes(key))\n\n        let notProcessed\n        while ((notProcessed = getNotProcessedKey()).length > 0) {\n            for (let key of notProcessed) {\n                await this.installers[key].install()\n            }\n            processed = processed.concat(notProcessed)\n        }\n\n        await Promise.all(this.postInstalls.map(cb => cb()))\n\n        await this.command.execAll(command => this.cliUtils.verbose(command))\n    }\n}\n\nmodule.exports = Setup\n"]}