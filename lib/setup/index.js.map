{"version":3,"sources":["../../src/setup/index.js"],"names":["process","require","fs","getConfig","Plugin","config","plugin","Fsio","Command","Operator","CliUtils","Setup","cliUtils","fsio","command","projectDir","installers","generators","noOpt","noUse","isUse","postInstalls","directories","getLocal","entries","target","builders","testers","opt","info","operator","addBuilder","name","length","error","writeLocal","processed","getNotProcessedKey","Object","keys","filter","includes","key","notProcessed","install","concat","Promise","all","map","cb","execAll","verbose","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\n// @flow\n\nconst process = require('process')\nconst fs = require('fs')\n\nconst {getConfig, Plugin} = require('../waterslide')\nconst config = getConfig()\nconst plugin = new Plugin()\nconst Fsio = require('./fsio')\nconst Command = require('./command')\nconst Operator = require('./operator')\nconst CliUtils = require('../cli/utils')\n\nimport type {Entry} from '../config'\n\nexport interface Generator {\n    generate(name: string, opts?: Object): void\n}\n\n// FIXME\nexport type Installer = any\n\n// export interface Installer {\n//     install: () => {},\n//     setDirectory?: (path: string, description?: string) => void\n// }\n\ntype Info = {\n    title: string,\n    message: string\n}\n\n\nclass Setup {\n    fsio: Fsio\n    command: Command\n    cliUtils: CliUtils\n    projectDir: ?string\n    installers: {[string]: Installer}\n    noOpt: Array<string>\n    noUse: Array<string>\n    opt: Array<string>\n    isUse: boolean\n    postInstalls: Array<() => void>\n    directories: {[string]: string}\n    generators: {[string]: Generator}\n    entries: Array<Entry>\n    operator: Operator\n    target: ?string\n    builders: Array<string>\n    testers: {[string]: string}\n    info: Array<Info>\n\n    constructor(cliUtils: CliUtils) {\n        this.fsio = new Fsio()\n        this.cliUtils = cliUtils\n        this.command = new Command(require('child_process'), cliUtils)\n        this.projectDir = null // FIXME\n        this.installers = {}\n        this.generators = {}\n        this.noOpt = []\n        this.noUse = []\n        this.isUse = false\n\n        this.postInstalls = []\n\n        this.directories = config.getLocal('directories') || {}\n        this.entries = config.getLocal('entries') || []\n        this.target = config.getLocal('target')\n        this.builders = config.getLocal('builders') || []\n        this.testers = config.getLocal('testers') || {}\n        this.opt = config.getLocal('opt') || []\n        this.info = config.getLocal('info') || []\n\n        this.operator = new Operator(this)\n\n        this.operator.addBuilder('copy')\n    }\n\n    setProjectDir(name: string) {\n        this.projectDir = name\n    }\n\n    setUse() {\n        this.isUse = true\n    }\n\n    setOpt(opt: Array<string>) {\n        if (this.opt.length > 0) {\n            this.cliUtils.error('warning: opt is already set.')\n        }\n\n        this.opt = opt\n        config.writeLocal('opt', this.opt)\n    }\n\n    setNoOpt(noOpt: Array<string>) {\n        if (this.noOpt.length > 0) {\n            this.cliUtils.error('warning: noOpts is already set.')\n        }\n\n        this.noOpt = noOpt\n    }\n\n    setNoUse(noUse: Array<string>) {\n        if (this.noUse.length > 0) {\n            this.cliUtils.error('warning: noUse is already set.')\n        }\n\n        this.noUse = noUse\n    }\n\n    async install() {\n        let processed = []\n\n        const getNotProcessedKey = () => Object.keys(this.installers).filter(key => !processed.includes(key))\n\n        let notProcessed\n        while ((notProcessed = getNotProcessedKey()).length > 0) {\n            for (let key of notProcessed) {\n                await this.installers[key].install()\n            }\n            processed = processed.concat(notProcessed)\n        }\n\n        await Promise.all(this.postInstalls.map(cb => cb()))\n\n        await this.command.execAll(command => this.cliUtils.verbose(command))\n    }\n}\n\nmodule.exports = Setup\n"]}